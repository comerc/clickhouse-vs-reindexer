# clickhouse-vs-reindexer

[трансляция](https://youtube.com/live/krXPKdiVums)

Задача: замерить Reindexer по условиям из первой заметки, т.к. во второй заметке ClickHouse показал очень плохие результаты.

1. [Делаем быстрый поиск по турам на основе ClickHouse](https://habr.com/ru/articles/324846/)
2. [Как мы выбирали между Elastic и Tarantool, а сделали свою (самую быструю) in-memory БД. С Join и полнотекстовым поиском](https://habr.com/ru/articles/346884/)

## как поднять ClickHouse в docker?

```bash
$ docker run -d --name some-clickhouse-server --ulimit nofile=262144:262144 clickhouse/clickhouse-server
```

Команда docker run -d используется для запуска контейнера в фоновом режиме. Здесь -d означает “detached”, что в переводе с английского означает “отсоединенный”.

```bash
$ docker run --name some-clickhouse-server -it --rm --ulimit nofile=262144:262144 -p 8123:8123 -p 9000:9000 clickhouse/clickhouse-server
```

--rm - удаляет конейнер после остановки, -it : -t выводит в tty(консоль) вывод, i- позволяет взаимодействовать с контейнером через консоль

или

```bash
$ cd ch-and-grafana && docker-compose up -d
```

## примеры применения ClickHouse

https://github.com/ClickHouse/examples

## что быстрее? clickhouse interface (formally native interface) vs database/sql interface

While the database/sql provides a database-agnostic interface, allowing developers to abstract their data store, it enforces some typing and query semantics that impact performance. For this reason, the client-specific API should be used where performance is important. However, users who wish to integrate ClickHouse into tooling, which supports multiple databases, may prefer to use the standard interface.

Both interfaces encode data using the native format and native protocol for communication. Additionally, the standard interface supports communication over HTTP.

## чем отличается ClickHouse от других баз данных?

ClickHouse отличается от других систем управления базами данных (СУБД) по нескольким ключевым параметрам:

1. **Архитектура**: ClickHouse использует колоночно-ориентированную архитектуру, которая спроектирована для улучшения производительности запросов и сокращения требований к хранению. Это контрастирует с MySQL, PostgreSQL и MongoDB, которые все являются строково-ориентированными.

2. **Производительность запросов**: ClickHouse оптимизирован для аналитических запросов, что делает его идеальным для компаний, которым нужно быстро обрабатывать большие наборы данных. MySQL и PostgreSQL - это более универсальные базы данных, которые могут обрабатывать как транзакционные, так и аналитические рабочие нагрузки, но они могут не работать так же хорошо, как ClickHouse, для аналитических запросов.

3. **Масштабируемость**: ClickHouse разработан для горизонтального масштабирования, позволяя компаниям распределять свои данные по нескольким серверам для улучшения производительности и емкости.

4. **Типы данных**: ClickHouse поддерживает широкий спектр типов данных, включая примитивные типы, массивы и сложные структуры.

5. **Интеграция с другими технологиями**: ClickHouse хорошо интегрируется с другими популярными технологиями и инструментами, включая Apache Kafka, Apache Spark и Grafana.

6. **Открытый исходный код и сообщество**: ClickHouse - это проект с открытым исходным кодом с растущим сообществом разработчиков и пользователей¹.

## чем отличается колоночно-ориентированная база данных от строково-ориентированной?

Колоночно-ориентированные и строково-ориентированные базы данных отличаются способом организации и хранения данных:

1. **Строково-ориентированные базы данных**: В этих базах данных данные хранятся построчно, так что все столбцы одной строки хранятся вместе. Это обеспечивает отличную производительность при запросе нескольких столбцов одной строки, что типично для приложений онлайн-транзакционной обработки (OLTP). Примеры строково-ориентированных баз данных: Postgres, MySQL.

2. **Колоночно-ориентированные базы данных**: В этих базах данных данные организуются по полям, причем все данные, связанные с одним полем, хранятся рядом друг с другом в памяти. Это обеспечивает преимущества в производительности при выполнении запросов к данным. Они оптимизированы для эффективного чтения и вычисления столбцов. Примеры колоночно-ориентированных баз данных: Redshift, BigQuery, Snowflake.

Важно отметить, что выбор между колоночно-ориентированной и строково-ориентированной базой данных в значительной степени зависит от конкретных требований к приложению. Строковые базы данных обычно лучше подходят для транзакционных систем, где часто требуется доступ ко всем полям записи. Колоночные базы данных лучше подходят для аналитических систем, где часто выполняются агрегатные запросы к большому числу записей, но только к небольшому числу полей.

## Reindexer

The core is written in C++ and the application level API is in Go.

![](./assets/reindexer-benchmarks)

## pv

```bash
$ cat tours.csv | pv | clickhouse --client --query 'INSERT INTO tours FORMAT CSVWithNames'
524MiB 0:00:04 [ 123MiB/s]
```

Если у вас ещё не уставлена утилита pv — рекомендую поставить, она позволяет печатать прогресс исполнения операций и показывает, сколько байт прошло через пайп.

## Выводы

Сравнение тёплого с мягким. Reindexer идеально применим для каталога товаров, ClickHouse - для аналитики и выборки туров для путешествий.
